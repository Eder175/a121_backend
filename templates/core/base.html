{% load static i18n widget_tweaks %}
<!DOCTYPE html>
<html lang="{% get_current_language as LANGUAGE_CODE %}{{ LANGUAGE_CODE|default:'pt-br' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://aframe.io https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://kit.fontawesome.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; connect-src 'self' ws: wss: https://rpc.testnet.a121chain.com;">
    <title>{% block title %}{% trans "A121 Evolution - A Revolução do Futuro" %}{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/estilos.css' %}">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js" defer></script>
    {% block extra_head %}{% endblock %}
</head>
<body>
    <div id="particles-js" class="particles-background"></div>
    <header class="header">
        <div class="container">
            <img src="{% static 'images/A121.png' %}" alt="{% trans 'A121 Evolution' %}" class="logo">
            <nav class="nav">
                <ul>
                    <li><a href="{% url 'core:index' %}" class="nav-link">{% trans "A Revolução" %}</a></li>
                    <li><a href="{% url 'core:cursos' %}" class="nav-link">{% trans "Cursos" %}</a></li>
                    {% if user.is_authenticated %}
                        <li><a href="{% url 'core:chat' %}" class="nav-link">{% trans "Chat" %}</a></li>
                        <li><a href="{% url 'core:logout' %}" class="nav-link">{% trans "Sair" %}</a></li>
                    {% else %}
                        <li><a href="{% url 'core:login' %}" class="nav-link">{% trans "Conecte-se" %}</a></li>
                    {% endif %}
                </ul>
                <select id="language-selector" class="language-selector">
                    <option value="pt-br">Português</option>
                    <option value="en">English</option>
                </select>
                <select id="currency-selector" class="currency-selector">
                    <option value="EUR">€ (EUR)</option>
                    <option value="USD">$ (USD)</option>
                </select>
            </nav>
        </div>
    </header>
    <main>{% block content %}{% endblock %}</main>
    <div class="chatbot-container">
        <div class="chatbot-hologram">
            <a-scene embedded renderer="colorManagement: true">
                <a-sphere id="chatbot-hologram-entity" color="#00ffcc" radius="0.3" position="0 0 -1" animation="property: rotation; to: 0 360 0; loop: true; dur: 5000">
                    <a-text id="chatbot-text" value="Olá! Sou o A121Bot!" align="center" position="0 0.5 0" color="#00ffcc"></a-text>
                </a-sphere>
                <a-camera position="0 1.6 0"></a-camera>
            </a-scene>
        </div>
        <div class="chatbot-messages" id="chatbot-messages"></div>
        <input type="text" id="chatbot-input" class="chatbot-input" placeholder="{% trans 'Digite ou fale...' %}">
        <button id="chatbot-voice" class="chatbot-voice">{% trans "Falar" %}</button>
        <button id="chatbot-vr" class="chatbot-vr">{% trans "VR" %}</button>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            particlesJS('particles-js', { particles: { number: { value: 200 }, color: { value: '#00ffcc' } } });
            const ws = new WebSocket('ws://localhost:8000/ws/chat/');
            ws.onmessage = (e) => {
                const data = JSON.parse(e.data);
                document.getElementById('chatbot-messages').innerHTML += `<p>A121Bot: ${data.message}</p>`;
            };
            document.getElementById('chatbot-voice').addEventListener('click', () => {
                const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.start();
                recognition.onresult = (e) => {
                    ws.send(JSON.stringify({ message: e.results[0][0].transcript }));
                };
            });
            document.getElementById('chatbot-vr').addEventListener('click', () => {
                const scene = document.createElement('a-scene');
                scene.setAttribute('vr-mode-ui', 'enabled: true');
                scene.innerHTML = `
                    <a-sky color="#000022"></a-sky>
                    <a-sphere position="0 1.6 -3" color="#00ffcc" radius="0.5"></a-sphere>
                    <a-camera position="0 1.6 0"></a-camera>
                `;
                document.body.appendChild(scene);
            });
        });
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>