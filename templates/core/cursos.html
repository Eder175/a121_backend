{% extends 'core/base.html' %}
{% load i18n static %}

{% block title %}
{% trans "Cursos A121 Revolution - Experiência do Futuro com A121Coin" %}
{% endblock %}

{% block extra_head %}
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>
{% endblock %}

{% block content %}
<section class="products" id="cursos">
    <div class="container">
        <h2>{% trans "Cursos do Futuro - Powered by A121 Neural AI & A121Coin" %}</h2>

        <!-- Carteira Virtual A121Coin -->
        <section class="a121coin-wallet">
            <h3>{% trans "Sua Carteira A121Coin" %}</h3>
            <p id="a121coin-balance">{% trans "Saldo:" %} 0 A121Coin</p>
            <p id="a121coin-nfts">{% trans "Seus NFTs:" %} 0</p>
            <div id="nft-gallery" class="nft-gallery"></div>
        </section>

        <!-- Experiência Imersiva com IA Emocional -->
        <section class="ai-emotional-experience">
            <h3>{% trans "A IA está analisando suas emoções..." %}</h3>
            <p id="emotional-feedback">{% trans "Você parece interessado! Vamos sugerir algo interativo!" %}</p>
        </section>

        <!-- Recomendações de Cursos com IA Neural -->
        <section class="ai-recommendations">
            <h3>{% trans "Cursos Personalizados para Você (A121 Neural AI)" %}</h3>
            <div id="ai-course-suggestions" class="product-grid"></div>
        </section>

        <!-- Lista de Cursos -->
        <div class="product-grid">
            <div class="product-card" data-course="ia">
                <div class="product-image-wrapper">
                    <img src="{% static 'images/IA.png' %}" alt="{% trans 'Introdução à IA' %}" class="product-image">
                    <button class="ar-button voice-interaction" data-course="ia">{% trans "Ver Prévia Holográfica (Fale para Interagir)" %}</button>
                    <div class="ar-scene-container" data-course="ia"></div>
                </div>
                <h3>{% trans "Introdução à IA" %}</h3>
                <p>{% trans "Aprenda os fundamentos da inteligência artificial e aplique-a em seu dia a dia." %}</p>
                <p>{% trans "Preço" %}: <span class="product-price" data-price="199.90">199.90 €</span></p>
                <p>{% trans "Duração" %}: 10 {% trans "horas" %}</p>
                <div class="language-selector-course">
                    <label for="language-ia">{% trans "Idioma do Curso:" %}</label>
                    <select id="language-ia" class="course-language-selector" data-course="ia">
                        <option value="en">English</option>
                        <option value="pt-br">Português</option>
                        <option value="ja">日本語 (Japanese)</option>
                        <option value="es">Español</option>
                        <option value="fr">Français</option>
                    </select>
                </div>
                <div class="translated-content" id="translated-content-ia">
                    <p>{% trans "Prévia do Vídeo Traduzido:" %}</p>
                    <audio id="translated-audio-ia" controls style="display: none;"></audio>
                    <p id="translated-text-ia"></p>
                    <p>{% trans "Material em PDF Traduzido:" %}</p>
                    <a id="translated-pdf-ia" href="#" style="display: none;">{% trans "Baixar PDF Traduzido" %}</a>
                </div>
                <a href="{% url 'core:cadastro' %}" class="btn">{% trans "Inscrever-se" %}</a>
                <button class="btn btn-ai-preview" data-course="ia">{% trans "Gerar Prévia com IA Neural" %}</button>
                <div class="ai-preview-content" id="ai-preview-ia"></div>
                <button class="btn btn-blockchain-cert" data-course="ia">{% trans "Emitir Certificado Holográfico (A121Coin)" %}</button>
                <div class="blockchain-cert-container" data-course="ia"></div>
            </div>
            <div class="product-card" data-course="finance">
                <div class="product-image-wrapper">
                    <img src="{% static 'images/financaspessoais.webp' %}" alt="{% trans 'Finanças Pessoais' %}" class="product-image">
                    <button class="ar-button voice-interaction" data-course="finance">{% trans "Ver Prévia Holográfica (Fale para Interagir)" %}</button>
                    <div class="ar-scene-container" data-course="finance"></div>
                </div>
                <h3>{% trans "Finanças Pessoais" %}</h3>
                <p>{% trans "Domine suas finanças e planeje seu futuro com este curso prático." %}</p>
                <p>{% trans "Preço" %}: <span class="product-price" data-price="149.90">149.90 €</span></p>
                <p>{% trans "Duração" %}: 8 {% trans "horas" %}</p>
                <div class="language-selector-course">
                    <label for="language-finance">{% trans "Idioma do Curso:" %}</label>
                    <select id="language-finance" class="course-language-selector" data-course="finance">
                        <option value="en">English</option>
                        <option value="pt-br">Português</option>
                        <option value="ja">日本語 (Japanese)</option>
                        <option value="es">Español</option>
                        <option value="fr">Français</option>
                    </select>
                </div>
                <div class="translated-content" id="translated-content-finance">
                    <p>{% trans "Prévia do Vídeo Traduzido:" %}</p>\n                    <audio id="translated-audio-finance" controls style="display: none;"></audio>\n                    <p id="translated-text-finance"></p>\n                    <p>{% trans "Material em PDF Traduzido:" %}</p>\n                    <a id="translated-pdf-finance" href="#" style="display: none;">{% trans "Baixar PDF Traduzido" %}</a>
                </div>
                <a href="{% url 'core:cadastro' %}" class="btn">{% trans "Inscrever-se" %}</a>
                <button class="btn btn-ai-preview" data-course="finance">{% trans "Gerar Prévia com IA Neural" %}</button>
                <div class="ai-preview-content" id="ai-preview-finance"></div>
                <button class="btn btn-blockchain-cert" data-course="finance">{% trans "Emitir Certificado Holográfico (A121Coin)" %}</button>
                <div class="blockchain-cert-container" data-course="finance"></div>
            </div>
        </div>

        <!-- Sistema de Gamificação -->
        <section class="gamification">
            <h3>{% trans "Ganhe A121Coin e NFTs Únicos!" %}</h3>
            <p id="gamification-tokens">{% trans "Você tem 0 A121Coin. Interaja para ganhar mais!" %}</p>
            <div id="holographic-reward"></div>
        </section>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<style>
    /* Mantido seu CSS original com ajustes para responsividade */
    .product-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; padding: 20px; }
    .product-card { background: rgba(255, 255, 255, 0.1); border: 1px solid #00ffcc; border-radius: 10px; padding: 20px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .product-card:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(0, 255, 204, 0.5); }
    .product-image { width: 100%; height: auto; border-radius: 5px; }
    .ar-button, .btn, .btn-ai-preview, .btn-blockchain-cert { background: #00ffcc; color: #000; border: none; padding: 10px 20px; border-radius: 5px; margin: 5px 0; cursor: pointer; font-family: 'Orbitron', sans-serif; transition: background 0.3s ease; }
    .ar-button:hover, .btn:hover, .btn-ai-preview:hover, .btn-blockchain-cert:hover { background: #00ccff; }
    .ar-scene-container, .blockchain-cert-container { width: 100%; height: 200px; display: none; }
    .nft-gallery { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .nft-item { background: rgba(0, 255, 204, 0.2); border: 1px solid #00ffcc; padding: 10px; border-radius: 5px; }
    @media (max-width: 768px) { .product-card { padding: 15px; } .product-grid { grid-template-columns: 1fr; } }
</style>
<script>
    // Web3 para A121Coin e NFTs
    const web3 = new Web3(Web3.givenProvider || "https://rpc.testnet.a121chain.com");
    const contractAddress = "0xYourContractAddress"; // Substituir pelo endereço real
    const contractABI = []; // Adicionar ABI do contrato A121Coin
    const a121Contract = new web3.eth.Contract(contractABI, contractAddress);

    // Gerenciar cenas A-Frame
    const activeScenes = new Map();
    function createARScene(course) {
        const scene = document.createElement('a-scene');
        scene.setAttribute('embedded', '');
        scene.setAttribute('renderer', 'colorManagement: true');
        scene.innerHTML = `
            <a-assets>
                <a-asset-item id="course-${course}-hologram" src="{% static 'models/course-${course}-hologram.glb' %}" response-type="arraybuffer"></a-asset-item>
            </a-assets>
            <a-entity id="hologram-${course}" gltf-model="#course-${course}-hologram" position="0 0 -1" scale="0.5 0.5 0.5" visible="false" animation="property: rotation; to: 0 360 0; loop: true; dur: 5000">
                <a-text id="hologram-text-${course}" value="Aula 1: ${course === 'ia' ? 'O que é IA?' : 'Criando um Orçamento'}" align="center" position="0 0.5 0" color="#00ffcc"></a-text>
            </a-entity>
            <a-camera position="0 1.6 0"></a-camera>
        `;
        return scene;
    }
    function createCertScene(course) {
        const scene = document.createElement('a-scene');
        scene.setAttribute('embedded', '');
        scene.setAttribute('renderer', 'colorManagement: true');
        scene.innerHTML = `
            <a-assets>
                <a-asset-item id="cert-${course}-hologram" src="{% static 'models/cert-${course}-hologram.glb' %}" response-type="arraybuffer"></a-asset-item>
            </a-assets>
            <a-entity gltf-model="#cert-${course}-hologram" position="0 0 -1" scale="0.5 0.5 0.5" animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-entity>
            <a-camera position="0 1.6 0"></a-camera>
        `;
        return scene;
    }
    function destroyScene(course, type) {
        const key = `${course}-${type}`;
        const scene = activeScenes.get(key);
        if (scene) {
            scene.parentElement.removeChild(scene);
            activeScenes.delete(key);
        }
    }

    // Animações GSAP
    gsap.from('.product-card', { opacity: 0, y: 50, duration: 1, stagger: 0.2, ease: "power3.out" });

    // IA Emocional
    let userEngagement = 0;
    document.addEventListener('click', () => {
        userEngagement++;
        const feedback = document.getElementById('emotional-feedback');
        if (userEngagement > 5) feedback.textContent = "{% trans 'Você está muito engajado! Vamos explorar uma experiência interativa!' %}";
        else if (userEngagement > 2) feedback.textContent = "{% trans 'Você parece interessado! Que tal uma prévia holográfica?' %}";
    });

    // Recomendações com TensorFlow.js
    async function loadAIRecommendations() {
        const suggestions = document.getElementById('ai-course-suggestions');
        const model = tf.sequential();
        model.add(tf.layers.dense({ units: 10, inputShape: [2], activation: 'relu' }));
        model.add(tf.layers.dense({ units: 1, activation: 'sigmoid' }));
        model.compile({ optimizer: 'adam', loss: 'binaryCrossentropy' });
        const userData = tf.tensor2d([[userEngagement, Math.random() * 10]], [1, 2]);
        const prediction = model.predict(userData).dataSync()[0];
        suggestions.innerHTML = prediction > 0.5 ? "Introdução à IA" : "Finanças Pessoais";
    }

    // Interação por Voz
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = '{{ LANGUAGE_CODE|default:"pt-br" }}';
    document.querySelectorAll('.voice-interaction').forEach(btn => {
        btn.addEventListener('click', () => {
            const course = btn.getAttribute('data-course');
            const container = btn.parentElement.querySelector('.ar-scene-container');
            if (!activeScenes.has(`${course}-ar`)) {
                const scene = createARScene(course);
                container.appendChild(scene);
                activeScenes.set(`${course}-ar`, scene);
            }
            container.style.display = 'block';
            const hologram = container.querySelector(`#hologram-${course}`);
            hologram.setAttribute('visible', 'true');
            recognition.start();
            recognition.onresult = (event) => {
                const command = event.results[0][0].transcript.toLowerCase();
                if (command.includes('aula 1')) hologram.querySelector('a-text').setAttribute('value', 'Aula 1: Iniciando');
            };
        });
    });

    // Gamificação com Web3
    let userA121Coin = 0;
    let userNFTs = [];
    async function updateGamification() {
        const accounts = await web3.eth.getAccounts();
        if (accounts.length) {
            const balance = await a121Contract.methods.balanceOf(accounts[0]).call();
            userA121Coin = web3.utils.fromWei(balance, 'ether');
            const tokensElement = document.getElementById('gamification-tokens');
            tokensElement.textContent = `{% trans "Você tem" %} ${userA121Coin} A121Coin. {% trans "Interaja para ganhar mais!" %}`;
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadAIRecommendations();
        updateGamification();
    });
</script>
{% endblock %}