{% extends 'core/base.html' %}
{% load i18n static %}

{% block title %}
{% trans "Conecte-se à A121 Revolution" %}
{% endblock %}

{% block content %}
<!-- Transição Quântica -->
<div class="quantum-transition" id="quantum-transition">
    <div id="quantum-particles" class="quantum-particles"></div>
</div>

<section class="auth-section">
    <div class="auth-container">
        <h2>{% trans "Conecte-se à A121 Revolution" %}</h2>
        <p class="subtitle">{% trans "Acesse o futuro cósmico agora!" %}</p>
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                    <div class="alert {% if message.tags %}{{ message.tags }}{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <!-- Carteira Virtual A121Coin -->
        <div class="a121coin-wallet">
            <h3>{% trans "Sua Carteira A121Coin" %}</h3>
            <p id="a121coin-balance">{% trans "Saldo:" %} 0 A121Coin</p>
            <p id="a121coin-nfts">{% trans "Seus NFTs:" %} 0</p>
        </div>

        <!-- IA Emocional -->
        <div class="ai-emotional-experience">
            <h3>{% trans "A IA está analisando suas emoções..." %}</h3>
            <p id="emotional-feedback">{% trans "Você parece pronto para se conectar ao futuro!" %}</p>
        </div>

        <!-- Assistente Holográfico (Comentado até que os modelos 3D estejam disponíveis) -->
        <!--
        <div class="assistant-hologram">
            <a-scene embedded arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;" class="assistant-ar-scene">
                <a-assets>
                    <a-asset-item id="assistant-hologram" src="{% static 'models/assistant-hologram.glb' %}"></a-asset-item>
                </a-assets>
                <a-entity id="assistant-hologram-entity" gltf-model="#assistant-hologram" scale="0.1 0.1 0.1" position="0 0 -1">
                    <a-text id="assistant-text" value="Bem-vindo à A121 Evolution! Fale 'login' para começar." align="center" position="0 0.5 0" color="#00ffcc"></a-text>
                </a-entity>
                <a-marker-camera preset="hiro"></a-marker-camera>
            </a-scene>
        </div>
        -->

        <!-- Formulário de Login -->
        <form method="post" class="auth-form" id="login-form">
            {% csrf_token %}
            <label for="email">{% trans "Email" %}</label>
            <input type="email" id="email" name="email" required>
            <label for="senha">{% trans "Senha" %}</label>
            <input type="password" id="senha" name="senha" required>
            <button type="submit" id="submit-button">{% trans "Entrar" %}</button>
        </form>

        <!-- Opção de Autenticação Biométrica -->
        <button class="btn btn-biometric btn-glow" id="biometric-login">{% trans "Login com Reconhecimento de Voz" %}</button>

        <!-- Opção de Login por Pensamento -->
        <button class="btn btn-mind-login btn-glow" id="mind-login">{% trans "Login com Pensamento (Interface Cérebro-Máquina)" %}</button>
        <p id="mind-login-instruction" style="display: none;">{% trans "Foco no botão 'ENTRAR' por 5 segundos para logar!" %}</p>

        <!-- Opção de Login em VR (Comentado até que os modelos 3D estejam disponíveis) -->
        <!--
        <button class="btn btn-vr btn-glow" id="vr-login">{% trans "Login em Realidade Virtual Cósmica" %}</button>
        <a-scene embedded vr-mode-ui="enabled: true" class="vr-login-scene" style="display: none;">
            <a-assets>
                <a-asset-item id="vr-login-hologram" src="{% static 'models/vr-login-hologram.glb' %}"></a-asset-item>
                <a-asset-item id="cosmic-skybox" src="{% static 'models/cosmic-skybox.glb' %}"></a-asset-item>
            </a-assets>
            <a-sky src="#cosmic-skybox"></a-sky>
            <a-entity gltf-model="#vr-login-hologram" scale="0.1 0.1 0.1" position="0 1.6 -1">
                <a-text value="A121 Evolution VR Login" align="center" position="0 0.5 0" color="#00ffcc"></a-text>
            </a-entity>
            <a-entity id="vr-form" position="0 1.6 -1">
                <a-text value="E-mail:" position="-0.5 0.2 0" color="#00ffcc"></a-text>
                <a-box id="vr-email-input" color="#00ffcc" width="1" height="0.1" depth="0.01" position="0.5 0.2 0"></a-box>
                <a-text value="Senha:" position="-0.5 0 0" color="#00ffcc"></a-text>
                <a-box id="vr-password-input" color="#00ffcc" width="1" height="0.1" depth="0.01" position="0.5 0 0"></a-box>
                <a-box id="vr-submit-button" color="#ff00cc" width="0.5" height="0.1" depth="0.01" position="0 -0.2 0">
                    <a-text value="ENTRAR" align="center" position="0 0 0.01" color="#ffffff"></a-text>
                </a-box>
            </a-entity>
            <a-entity camera look-controls position="0 1.6 0">
                <a-entity cursor="fuse: true; fuseTimeout: 500" raycaster="objects: #vr-submit-button" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02" material="color: #00ffcc; shader: flat"></a-entity>
            </a-entity>
        </a-scene>
        -->

        <div class="auth-links">
            <p>{% trans "Não tem uma conta?" %} <a href="{% url 'core:cadastro' %}">{% trans "Junte-se" %}</a></p>
        </div>

        <!-- Hash de Autenticação Blockchain -->
        <div class="blockchain-auth" id="blockchain-auth" style="display: none;">
            <p>{% trans "Autenticação Segura via A121Chain" %}</p>
            <p id="auth-hash"></p>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js"></script>
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script src="{% static 'js/main.js' %}"></script>
<script>
// Estado do Usuário (Persistente entre Páginas)
let userA121Coin = localStorage.getItem('userA121Coin') ? parseInt(localStorage.getItem('userA121Coin')) : 0;
let userNFTs = localStorage.getItem('userNFTs') ? JSON.parse(localStorage.getItem('userNFTs')) : [];

// Atualizar Carteira Virtual
function updateWallet() {
    const balanceElement = document.getElementById('a121coin-balance');
    const nftsElement = document.getElementById('a121coin-nfts');
    balanceElement.textContent = `{% trans "Saldo:" %} ${userA121Coin} A121Coin`;
    nftsElement.textContent = `{% trans "Seus NFTs:" %} ${userNFTs.length}`;
}

// IA Emocional (Simulação)
let userEngagement = 0;
function trackUserEngagement() {
    const feedbackElement = document.getElementById('emotional-feedback');
    document.addEventListener('click', () => {
        userEngagement += 1;
        if (userEngagement > 5) {
            feedbackElement.textContent = "{% trans 'Você está muito animado! Vamos tornar sua experiência ainda mais incrível!' %}";
            document.querySelector('.auth-section').style.background = 'linear-gradient(135deg, #00ffcc, #ff00cc)';
        } else if (userEngagement > 2) {
            feedbackElement.textContent = "{% trans 'Você parece focado! Vamos te ajudar a se conectar rapidamente!' %}";
        }
    });
}

// Autenticação Biométrica com Reconhecimento de Voz (Simulação)
const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
recognition.lang = '{{ LANGUAGE_CODE|default:"pt-br" }}';
recognition.continuous = false;

document.getElementById('biometric-login').addEventListener('click', () => {
    recognition.start();
    recognition.onresult = (event) => {
        const command = event.results[0][0].transcript.toLowerCase();
        if (command.includes('login') || command.includes('entrar')) {
            document.getElementById('login-form').submit();
        } else {
            alert('Comando não reconhecido. Tente dizer "login" ou "entrar".');
        }
    };
});

// Login com Pensamento (Simulação de Interface Cérebro-Máquina)
let focusTime = 0;
document.getElementById('mind-login').addEventListener('click', () => {
    const instruction = document.getElementById('mind-login-instruction');
    instruction.style.display = 'block';
    const submitButton = document.getElementById('submit-button');
    const interval = setInterval(() => {
        if (document.activeElement === submitButton) {
            focusTime += 1;
            if (focusTime >= 5) {
                document.getElementById('login-form').submit();
                clearInterval(interval);
            }
        } else {
            focusTime = 0;
        }
    }, 1000);
});

// Login em Realidade Virtual Cósmica (Comentado até que os modelos 3D estejam disponíveis)
/*
document.getElementById('vr-login').addEventListener('click', () => {
    const vrScene = document.querySelector('.vr-login-scene');
    vrScene.style.display = 'block';
    vrScene.enterVR();
    const vrSubmitButton = document.getElementById('vr-submit-button');
    vrSubmitButton.addEventListener('click', () => {
        document.getElementById('login-form').submit();
    });
});
*/

// Transição Quântica ao Fazer Login
document.getElementById('login-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const quantumTransition = document.getElementById('quantum-transition');
    quantumTransition.style.display = 'block';
    particlesJS('quantum-particles', {
        particles: {
            number: { value: 500, density: { enable: true, value_area: 800 } },
            color: { value: '#ff00cc' },
            shape: { type: 'circle' },
            opacity: { value: 0.7, random: true },
            size: { value: 3, random: true },
            move: { enable: true, speed: 10, direction: 'none', random: true, out_mode: 'out' }
        }
    });
    setTimeout(() => {
        const authHash = `0x${Math.random().toString(16).substr(2, 40)}`;
        document.getElementById('blockchain-auth').style.display = 'block';
        document.getElementById('auth-hash').textContent = `Hash: ${authHash}`;
        setTimeout(() => {
            document.getElementById('login-form').submit();
        }, 2000);
    }, 2000);
});

// Inicializar Funcionalidades
document.addEventListener('DOMContentLoaded', () => {
    trackUserEngagement();
    updateWallet();
});
</script>
{% endblock %}