{% extends 'core/base.html' %}
{% load i18n static %}

{% block title %}
{% trans "A121 Evolution - Login do Futuro Cósmico" %}
{% endblock %}

{% block extra_head %}
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<style>
    .quantum-transition { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); display: none; z-index: 9999; }
    .quantum-particles { width: 100%; height: 100%; }
</style>
{% endblock %}

{% block content %}
<div id="particles-js" class="particles-background"></div>
<div class="quantum-transition" id="quantum-transition">
    <div id="quantum-particles" class="quantum-particles"></div>
    <div class="quantum-loader">{% trans "Processando autenticação..." %}</div>
</div>
<section class="login-section">
    <div class="container">
        <div class="login-container">
            <h2 class="title-glow">{% trans "Conecte-se à A121 Evolution" %}</h2>
            <p class="subtitle">{% trans "Acesse o futuro cósmico agora!" %}</p>
            <div class="a121coin-wallet">
                <h3>{% trans "Sua Carteira A121Coin" %}</h3>
                <p id="a121coin-balance">{% trans "Saldo:" %} 0 A121Coin</p>
                <p id="a121coin-nfts">{% trans "Seus NFTs:" %} 0</p>
            </div>
            <div class="ai-emotional-experience">
                <h3>{% trans "A IA está analisando suas emoções..." %}</h3>
                <p id="emotional-feedback">{% trans "Você parece pronto para se conectar ao futuro!" %}</p>
            </div>
            <form method="POST" class="login-form" id="login-form">
                {% csrf_token %}
                <div class="form-group">
                    <label for="email">{% trans "E-mail" %}</label>
                    <input type="email" id="email" name="email" required class="input-glow">
                </div>
                <div class="form-group">
                    <label for="senha">{% trans "Senha" %}</label>
                    <input type="password" id="senha" name="senha" required class="input-glow">
                </div>
                <button type="submit" class="btn btn-primary btn-glow" id="submit-button">{% trans "ENTRAR" %}</button>
                <p class="form-footer">{% trans "Ainda não tem uma conta?" %} <a href="{% url 'core:cadastro' %}" class="link-glow">{% trans "Cadastre-se" %}</a></p>
            </form>
            <button class="btn btn-vr" id="vr-login">{% trans "Login em Realidade Virtual Cósmica" %}</button>
            <button class="btn btn-biometric" id="biometric-login">{% trans "Login com Voz" %}</button>
            <button class="btn btn-mind-login" id="mind-login">{% trans "Login com Pensamento" %}</button>
            <p id="mind-login-instruction" style="display: none;">{% trans "Foco no botão 'ENTRAR' por 5 segundos para logar!" %}</p>
            <div class="blockchain-auth" id="blockchain-auth" style="display: none;">
                <p>{% trans "Autenticação Segura via A121Chain" %}</p>
                <p id="auth-hash"></p>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        particlesJS('particles-js', { particles: { number: { value: 200 }, color: { value: '#00ffcc' }, move: { enable: true, speed: 6 } } });

        let userEngagement = 0;
        document.addEventListener('click', () => {
            userEngagement++;
            const feedback = document.getElementById('emotional-feedback');
            if (userEngagement > 5) feedback.textContent = "{% trans 'Você está muito animado! Vamos tornar sua experiência ainda mais incrível!' %}";
            else if (userEngagement > 2) feedback.textContent = "{% trans 'Você parece focado! Vamos te ajudar a se conectar rapidamente!' %}";
        });

        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = '{{ LANGUAGE_CODE|default:"pt-br" }}';
        document.getElementById('biometric-login').addEventListener('click', () => {
            recognition.start();
            recognition.onresult = (event) => {
                if (event.results[0][0].transcript.toLowerCase().includes('entrar')) {
                    document.getElementById('login-form').submit();
                }
            };
        });

        let focusTime = 0;
        document.getElementById('mind-login').addEventListener('click', () => {
            document.getElementById('mind-login-instruction').style.display = 'block';
            const interval = setInterval(() => {
                if (document.activeElement === document.getElementById('submit-button')) {
                    focusTime++;
                    if (focusTime >= 5) {
                        document.getElementById('login-form').submit();
                        clearInterval(interval);
                    }
                }
            }, 1000);
        });

        document.getElementById('vr-login').addEventListener('click', () => {
            const scene = document.createElement('a-scene');
            scene.setAttribute('vr-mode-ui', 'enabled: true');
            scene.innerHTML = `
                <a-assets><video id="cosmic-skybox" src="{% static 'videos/futuristic_background.mp4' %}" autoplay loop></video></a-assets>
                <a-sky src="#cosmic-skybox"></a-sky>
                <a-camera position="0 1.6 0"></a-camera>
            `;
            document.body.appendChild(scene);
        });

        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const quantumTransition = document.getElementById('quantum-transition');
            quantumTransition.style.display = 'flex';
            particlesJS('quantum-particles', {
                particles: { number: { value: 500 }, color: { value: '#ff00cc' }, move: { enable: true, speed: 10 } }
            });
            setTimeout(() => {
                const authHash = `0x${Math.random().toString(16).substr(2, 40)}`;
                document.getElementById('blockchain-auth').style.display = 'block';
                document.getElementById('auth-hash').textContent = `Hash: ${authHash}`;
                setTimeout(() => document.getElementById('login-form').submit(), 2000);
            }, 2000);
        });
    });
</script>
{% endblock %}